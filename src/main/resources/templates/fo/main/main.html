<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="/css/common/header.css">
    <link rel="stylesheet" href="/css/main.css">
    <meta charset="UTF-8">
    <title>í”Œë ˆì´ì–´ ë§¤ì¹­ UI</title>

    <!-- ë¡œê·¸ì¸ í•„ìš” íŒì—… ìŠ¤í¬ë¦½íŠ¸ -->
    <script th:if="${popup}" defer>
        window.addEventListener('DOMContentLoaded', () => {
            alert([[${popup}]]);
        });
    </script>
</head>
<body>

<div th:replace="~{fo/common/header :: header}"></div>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="í”Œë ˆì´ì–´ ì´ë¦„ (í”Œë ˆì´ì–´#KR1)">
    <div id="autocompleteList" class="autocomplete-box"></div>
</div>

<div class="player-list">
    <div class="player-item">
        <span>í”Œë ˆì´ì–´1</span>
        <button onclick="toggleChatPopup()">ğŸ’¬</button>
    </div>
    <div class="player-item">
        <span>í”Œë ˆì´ì–´2</span>
        <button onclick="toggleChatPopup()">ğŸ’¬</button>
    </div>
    <div class="player-item">
        <span>í”Œë ˆì´ì–´3</span>
        <button onclick="toggleChatPopup()">ğŸ’¬</button>
    </div>
    <button class="more-button">ë”ë³´ê¸°</button>
</div>

<div class="clan-section">
    <div class="clan-title" onclick="location.href='/clan'">í´ëœì°¾ê¸° ></div>
    <div class="clan-cards">
        <div class="clan-card" onclick="toggleChatPopup()">í”Œì´ì¢‹ì•„</div>
        <div class="clan-card" onclick="toggleChatPopup()">í”Œì´ì¢‹ì•„</div>
        <div class="clan-card" onclick="toggleChatPopup()">í”Œì´ì¢‹ì•„</div>
    </div>
</div>



<!-- íŒì—… ë©”ì‹œì§€ -->
<div th:if="${popup}">
    <script>
        alert([[${popup}]]);
    </script>
</div>

<script>

    const searchInput = document.getElementById("searchInput");
    const autocompleteList = document.getElementById("autocompleteList");

    searchInput.addEventListener("input", async function () {
        const keyword = searchInput.value.trim();
        if (keyword.length < 2) {
            autocompleteList.innerHTML = "";
            return;
        }

        const res = await fetch(`/match/autocomplete?keyword=${encodeURIComponent(keyword)}`);
        const suggestions = await res.json();

        autocompleteList.innerHTML = suggestions.map(s => `
        <div class="autocomplete-item" onclick="selectRiotId('${s}')">${s}</div>
    `).join("");
    });

    searchInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            const inputValue = searchInput.value.trim();
            const [gameName, tagLine] = inputValue.split("#");

            if (!gameName || !tagLine) {
                alert("Riot ID í˜•ì‹ì€ 'ë‹‰ë„¤ì„#íƒœê·¸'ì…ë‹ˆë‹¤.");
                return;
            }

            window.location.href = `/match?gameName=${encodeURIComponent(gameName)}&tagLine=${encodeURIComponent(tagLine)}`;
        }
    });

    function selectRiotId(riotId) {
        const [gameName, tagLine] = riotId.split("#");
        window.location.href = `/match?gameName=${encodeURIComponent(gameName)}&tagLine=${encodeURIComponent(tagLine)}`;
    }

</script>

</body>
</html>
