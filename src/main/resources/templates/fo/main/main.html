<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <link rel="stylesheet" href="/css/common/header.css">
    <link rel="stylesheet" href="/css/main.css">
    <meta charset="UTF-8">
    <title>플레이어 매칭 UI</title>

    <!-- 로그인 필요 팝업 스크립트 -->
    <script th:if="${popup}" defer>
        window.addEventListener('DOMContentLoaded', () => {
            alert([[${popup}]]);
        });
    </script>
</head>
<body>

<div th:replace="~{fo/common/header :: header}"></div>

<div class="search-box">
    <input type="text" id="searchInput" placeholder="플레이어 이름 (플레이어#KR1)">
    <div id="autocompleteList" class="autocomplete-box"></div>
</div>

<div class="player-list">
    <div class="player-item">
        <span>플레이어1</span>
        <button onclick="toggleChatPopup()">💬</button>
    </div>
    <div class="player-item">
        <span>플레이어2</span>
        <button onclick="toggleChatPopup()">💬</button>
    </div>
    <div class="player-item">
        <span>플레이어3</span>
        <button onclick="toggleChatPopup()">💬</button>
    </div>
    <button class="more-button">더보기</button>
</div>

<div class="clan-section">
    <div class="clan-title" onclick="location.href='/clan'">클랜찾기 ></div>
    <div class="clan-cards">
        <div class="clan-card" onclick="toggleChatPopup()">플이좋아</div>
        <div class="clan-card" onclick="toggleChatPopup()">플이좋아</div>
        <div class="clan-card" onclick="toggleChatPopup()">플이좋아</div>
    </div>
</div>



<!-- 팝업 메시지 -->
<div th:if="${popup}">
    <script>
        alert([[${popup}]]);
    </script>
</div>

<script>

    const searchInput = document.getElementById("searchInput");
    const autocompleteList = document.getElementById("autocompleteList");

    searchInput.addEventListener("input", async function () {
        const keyword = searchInput.value.trim();
        if (keyword.length < 2) {
            autocompleteList.innerHTML = "";
            return;
        }

        const res = await fetch(`/match/autocomplete?keyword=${encodeURIComponent(keyword)}`);
        const suggestions = await res.json();

        autocompleteList.innerHTML = suggestions.map(s => `
        <div class="autocomplete-item" onclick="selectRiotId('${s}')">${s}</div>
    `).join("");
    });

    searchInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
            const inputValue = searchInput.value.trim();
            const [gameName, tagLine] = inputValue.split("#");

            if (!gameName || !tagLine) {
                alert("Riot ID 형식은 '닉네임#태그'입니다.");
                return;
            }

            window.location.href = `/match?gameName=${encodeURIComponent(gameName)}&tagLine=${encodeURIComponent(tagLine)}`;
        }
    });

    function selectRiotId(riotId) {
        const [gameName, tagLine] = riotId.split("#");
        window.location.href = `/match?gameName=${encodeURIComponent(gameName)}&tagLine=${encodeURIComponent(tagLine)}`;
    }

</script>

</body>
</html>
