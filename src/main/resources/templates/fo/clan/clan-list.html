<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8" />
  <meta name="_csrf" th:content="${_csrf.token}">
  <meta name="_csrf_parameter" th:content="${_csrf.parameterName}">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <title>í´ëœ ì°¾ê¸°</title>
  <link rel="stylesheet" href="/css/clan.css" />
</head>
<body>
<header>
  <div class="logo" onclick="location.href='/main'">plit</div>
  <nav>
    <a href="/party">íŒŒí‹°ì°¾ê¸°</a>
    <a href="/record">ë‚´ì „ì°¾ê¸°</a>
    <a href="/clan" style="color: yellow;">í´ëœì°¾ê¸°</a>
    <a href="/report">íŠ¸ë¡¤ì‹ ê³ </a>
  </nav>
  <div style="display: flex; align-items: center; gap: 15px;">
    <div onclick="toggleChatList()" style="cursor: pointer; font-size: 30px;">ğŸ’¬</div>
    <div sec:authorize="isAuthenticated()" style="display: flex; align-items: center; gap: 10px;">
      <span th:text="${#authentication.name} + ' ë‹˜'" style="font-weight: bold;"></span>
      <button onclick="location.href='/mypage'">ë§ˆì´í˜ì´ì§€</button>
      <button onclick="location.href='/logout'">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    <div sec:authorize="isAnonymous()">
      <button onclick="location.href='/login'">ë¡œê·¸ì¸</button>
    </div>
  </div>
</header>

<div class="container">
  <div class="search-bar">
    <form method="get" action="/clan" id="searchForm">
      <div class="search-left">
        <select name="tier" onchange="document.getElementById('searchForm').submit()">
          <option value="" th:selected="${tier == null or tier == ''}">í‹°ì–´ ì „ì²´</option>
          <option value="ìƒê´€ì—†ìŒ" th:selected="${tier == 'ìƒê´€ì—†ìŒ'}">í‹°ì–´ ìƒê´€ ì—†ìŒ</option>
          <option value="ì•„ì´ì–¸" th:selected="${tier == 'ì•„ì´ì–¸'}">ì•„ì´ì–¸</option>
          <option value="ë¸Œë¡ ì¦ˆ" th:selected="${tier == 'ë¸Œë¡ ì¦ˆ'}">ë¸Œë¡ ì¦ˆ</option>
          <option value="ì‹¤ë²„" th:selected="${tier == 'ì‹¤ë²„'}">ì‹¤ë²„</option>
          <option value="ê³¨ë“œ" th:selected="${tier == 'ê³¨ë“œ'}">ê³¨ë“œ</option>
          <option value="í”Œë ˆí‹°ë„˜" th:selected="${tier == 'í”Œë ˆí‹°ë„˜'}">í”Œë ˆí‹°ë„˜</option>
          <option value="ì—ë©”ë„ë“œ" th:selected="${tier == 'ì—ë©”ë„ë“œ'}">ì—ë©”ë„ë“œ</option>
          <option value="ë‹¤ì´ì•„" th:selected="${tier == 'ë‹¤ì´ì•„'}">ë‹¤ì´ì•„</option>
          <option value="ë§ˆìŠ¤í„°" th:selected="${tier == 'ë§ˆìŠ¤í„°'}">ë§ˆìŠ¤í„°</option>
          <option value="ê·¸ëœë“œë§ˆìŠ¤í„°" th:selected="${tier == 'ê·¸ëœë“œë§ˆìŠ¤í„°'}">ê·¸ëœë“œë§ˆìŠ¤í„°</option>
          <option value="ì±Œë¦°ì €" th:selected="${tier == 'ì±Œë¦°ì €'}">ì±Œë¦°ì €</option>
        </select>
        <input type="text" name="keyword" placeholder="í´ëœëª… ë˜ëŠ” ì†Œê°œ ê²€ìƒ‰" />
        <button type="submit" class="btn">ê²€ìƒ‰</button>
      </div>
    </form>

    <!-- í´ëœ ë“±ë¡ ë²„íŠ¼ -->
    <div sec:authorize="isAuthenticated()">
      <a href="javascript:void(0);" class="btn" onclick="openModal()">í´ëœë“±ë¡</a>
    </div>
    <div sec:authorize="isAnonymous()">
      <a href="/login" class="btn">í´ëœë“±ë¡</a>
    </div>

    <div id="clanModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>í´ëœ ë“±ë¡í•˜ê¸°</h2>
        <form method="post" action="/clan/register" enctype="multipart/form-data" style="padding: 0 16px;">
          <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

          <div th:if="${error}" style="color: red; text-align: center; margin: 10px 0;">
            <p th:text="${error}"></p>
          </div>
          <input type="text" name="name" placeholder="í´ëœ ì´ë¦„" required />
          <input type="text" name="summonerName" placeholder="ì†Œí™˜ì‚¬ ì´ë¦„" required />
          <label for="imageUpload" class="image-label">ì´ë¯¸ì§€ ë“±ë¡í•˜ê¸°</label>
          <input type="file" id="imageUpload" name="imageFile" accept="image/*" onchange="previewImage(event)" />
          <img id="imagePreview" style="max-width: 100%; margin-top: 10px;" />
          <textarea name="intro" placeholder="í´ëœ ì†Œê°œ" required></textarea>
          <select name="minTier" required>
            <option value="">í‹°ì–´ ì„ íƒ</option>
            <option value="ìƒê´€ì—†ìŒ">í‹°ì–´ ìƒê´€ ì—†ìŒ</option>
            <option value="ì•„ì´ì–¸">ì•„ì´ì–¸</option>
            <option value="ë¸Œë¡ ì¦ˆ">ë¸Œë¡ ì¦ˆ</option>
            <option value="ì‹¤ë²„">ì‹¤ë²„</option>
            <option value="ê³¨ë“œ">ê³¨ë“œ</option>
            <option value="í”Œë ˆí‹°ë„˜">í”Œë ˆí‹°ë„˜</option>
            <option value="ì—ë©”ë„ë“œ">ì—ë©”ë„ë“œ</option>
            <option value="ë‹¤ì´ì•„">ë‹¤ì´ì•„</option>
            <option value="ë§ˆìŠ¤í„°">ë§ˆìŠ¤í„°</option>
            <option value="ê·¸ëœë“œë§ˆìŠ¤í„°">ê·¸ëœë“œë§ˆìŠ¤í„°</option>
            <option value="ì±Œë¦°ì €">ì±Œë¦°ì €</option>
          </select>
          <input type="url" name="discordLink" placeholder="ë””ìŠ¤ì½”ë“œ ì´ˆëŒ€ ì£¼ì†Œ" />
          <input type="url" name="kakaoLink" placeholder="ì¹´ì¹´ì˜¤í†¡ ì˜¤í”ˆì±„íŒ… ì£¼ì†Œ" />
          <div style="text-align: right;">
            <button type="submit" class="btn">ë“±ë¡í•˜ê¸°</button>
            <button type="button" class="btn" onclick="closeModal()">ì·¨ì†Œ</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="clan-grid">
    <div class="clan-card" th:each="clan : ${clans}" th:onclick="|location.href='/clan/${clan.id}'|" style="cursor: pointer;">
      <div class="clan-image-placeholder">
        <img th:src="${clan.imageUrl != null ? clan.imageUrl : '/images/default.png'}" alt="í´ëœ ì´ë¯¸ì§€" style="width: 100%; height: 100%; object-fit: cover;" />
      </div>

      <!-- í´ëœ ë“±ë¡ í¼ ë‚´ë¶€ -->
      <div th:if="${linkError}" class="error-msg" style="color: red; text-align: center; font-weight: bold;">
        <p th:text="${linkError}"></p>
      </div>

      <div class="clan-title-box">
        <h3 th:text="${clan.name}">í´ëœì´ë¦„</h3>
        <span class="clan-member-count">0ëª…</span>
      </div>
      <p th:text="${clan.intro}">ì†Œê°œê¸€</p>
      <small style="display: flex; align-items: center; width: 100%;">
        <span style="padding-left: 0.75rem; flex-shrink: 0;"
              th:text="${clan.minTier == 'ì±Œë¦°ì €' ? 'ì±Œë¦°ì €' :
                       (clan.minTier == 'ìƒê´€ì—†ìŒ' ? 'í‹°ì–´ ìƒê´€ ì—†ìŒ' :
                       clan.minTier + ' ì´ìƒ')}"></span>
        <div style="flex-grow: 1;"></div>
        <span class="clan-links" style="padding-right: 0.75rem; display: flex; gap: 4px;">
          <a th:if="${clan.discordLink != null and !#strings.isEmpty(clan.discordLink)}" th:href="${clan.discordLink}" target="_blank" onclick="event.stopPropagation()">
            <img src="/images/discord-icon.png" alt="Discord" class="social-icon" />
          </a>
          <a th:if="${clan.kakaoLink != null and !#strings.isEmpty(clan.kakaoLink)}" th:href="${clan.kakaoLink}" target="_blank" onclick="event.stopPropagation()">
            <img src="/images/kakao-icon.png" alt="KakaoTalk" class="social-icon" />
          </a>
        </span>
      </small>
    </div>
  </div>
</div>

<footer>
  <div class="container">
    <div class="footer-nav">
      <a href="#">ê³µì§€ì‚¬í•­</a>
      <a href="#">ì‚¬ìš©ë°©ë²•</a>
      <a href="#">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</a>
      <a href="#">ê´‘ê³ /ì œíœ´ë¬¸ì˜</a>
      <a href="#">ê°œë°œë¬¸ì˜</a>
      <a href="#">404 Squad</a>
    </div>
    <div>
      lol.ps is hosted by PS Analytics, Inc. This site isn't endorsed by Riot Games and doesnâ€™t reflect their views.
      League of Legends is a trademark of Riot Games.
    </div>
  </div>
</footer>

<script>
  function openModal() {
    document.getElementById("clanModal").style.display = "block";
  }
  function closeModal() {
    document.getElementById("clanModal").style.display = "none";
  }
  function previewImage(event) {
    const reader = new FileReader();
    reader.onload = function () {
      const output = document.getElementById('imagePreview');
      output.src = reader.result;
    };
    reader.readAsDataURL(event.target.files[0]);
  }
  function toggleChatList() {
    alert('ì±„íŒ… ë¦¬ìŠ¤íŠ¸ ì—´ê¸° êµ¬í˜„ í•„ìš”');
  }

  document.querySelector("form[action='/clan/register']").addEventListener("submit", function (e) {
    console.log("í¼ ì œì¶œë¨!");
  });
</script>
</body>
</html>
