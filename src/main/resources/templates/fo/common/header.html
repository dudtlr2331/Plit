<div th:fragment="header"
     xmlns:th="http://www.thymeleaf.org"
     xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

    <header>
        <meta name="login-user-seq" th:if="${loginUser != null}" th:content="${loginUser.userSeq}" />

        <a th:href="@{/main}" class="logo">
            <img th:src="@{/images/logo/plit_logo_w.png}" alt="Logo" style="height: 30px;">
        </a>

        <nav>
            <a th:href="@{/party}">íŒŒí‹°ì°¾ê¸°</a>
            <a th:href="@{/clan}">í´ëœì°¾ê¸°</a>
            <a th:href="@{/report}">íŠ¸ë¡¤ì‹ ê³ </a>
        </nav>

        <div class="header-user-area">
            <div class="chat-icon">ğŸ’¬</div>

            <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
            <div sec:authorize="isAuthenticated()" class="auth-area">
                <span th:if="${loginUser != null}" th:text="${loginUser.userNickname}">ë‹‰ë„¤ì„</span>
                <span th:if="${loginUser == null}">ë¹„íšŒì›</span>


                <button class="btn btn-mypage" onclick="location.href='/mypage'">ë§ˆì´í˜ì´ì§€</button>

                <form th:action="@{/logout}" method="post" style="display:inline;">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit" class="btn btn-logout">ë¡œê·¸ì•„ì›ƒ</button>
                </form>
            </div>

            <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->
            <div sec:authorize="isAnonymous()">
                <button class="btn btn-login" onclick="location.href='/login'">ë¡œê·¸ì¸</button>
            </div>
        </div>



        <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
        <script src="/js/chatPopup.js"></script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const loginUserId = document.querySelector('meta[name="login-user-seq"]')?.getAttribute('content');
                if (loginUserId) {
                    initChatFeature(loginUserId);
                }
            });
        </script>
    </header>
</div>
