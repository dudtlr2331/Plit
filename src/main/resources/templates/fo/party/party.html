<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>íŒŒí‹° ì°¾ê¸° í˜ì´ì§€</title>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #fff; }
    header { background: #ff5a5a; color: white; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
    header nav { display: flex; align-items: center; }
    header nav a { margin: 0 10px; color: white; text-decoration: none; font-weight: bold; cursor: pointer; }
    .chat-button { background: none; border: none; font-size: 20px; margin-right: 10px; cursor: pointer; }
    .chat-popup { display: none; position: absolute; top: 60px; right: 80px; width: 250px; background: white; border: 1px solid #ccc; border-radius: 8px; padding: 10px; z-index: 999; }
    .chat-popup div { padding: 5px; border-bottom: 1px solid #eee; cursor: pointer; }
    .tab-container { display: flex; justify-content: center; margin: 20px 0; }
    .tab { padding: 10px 20px; margin: 0 5px; border-radius: 10px; background: #eee; cursor: pointer; font-weight: bold; }
    .tab.active { background: #ff5a5a; color: white; }
    .filter-bar { max-width: 900px; margin: auto; display: flex; justify-content: space-between; align-items: center; gap: 10px; padding: 10px; }
    .position-icons img { width: 30px; height: 30px; margin: 0 3px; cursor: pointer; }
    select { padding: 6px 10px; border-radius: 5px; }
    .recruit-list { max-width: 900px; margin: auto; }
    .recruit-header, .recruit-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; }
    .recruit-header { background: #f3f3f3; font-weight: bold; border-bottom: 2px solid #ccc; }
    .recruit-item { background: #f8f8f8; margin: 5px 0; border-radius: 8px; }
    .recruit-item span { margin-right: 10px; }
    .chat-icon { cursor: pointer; }
    .recruit-button { padding: 6px 12px; background: #ff5a5a; color: white; border: none; border-radius: 5px; cursor: pointer; }
    .position-selector span { font-size: 24px; margin-right: 10px; cursor: pointer; padding: 5px; border-radius: 5px; }
    .position-selector span.selected { background-color: #ff5a5a; color: white; }
    .recruit-popup, #partyDetailPopup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border: 1px solid #ccc; padding: 20px; border-radius: 10px; width: 900px; max-height: 800px; overflow: auto; z-index: 1000; }
    .chatbox { display: none; position: fixed; bottom: 20px; right: 20px; width: 300px; height: 400px; background: white; border: 1px solid #ccc; border-radius: 10px; padding: 10px; z-index: 1000; }
  </style>
  <link rel="stylesheet" th:href="@{/css/party-popup.css}">
</head>
<body>
<header>
  <nav>
    <a href="/main">Logo</a>
    <a href="/party">íŒŒí‹°ì°¾ê¸°</a>
    <a href="/clan">í´ëœì°¾ê¸°</a>
    <a href="/report">íŠ¸ë¡¤ì‹ ê³ </a>
  </nav>
  <nav>
    <button class="chat-button" onclick="toggleChatList()">ğŸ’¬</button>
    <a href="/login">ë¡œê·¸ì¸</a>
  </nav>
  <div id="chatList" class="chat-popup">
    <div onclick="toggleChatBox('user1')">í”Œë ˆì´ì–´1</div>
    <div onclick="toggleChatBox('user2')">í”Œë ˆì´ì–´2</div>
    <div onclick="toggleChatBox('user3')">í”Œë ˆì´ì–´3</div>
  </div>
</header>

<div class="tab-container">
  <div class="tab" id="soloTab">ì†”ë¡œ ë­í¬</div>
  <div class="tab" id="freeTab">ììœ  ë­í¬</div>
</div>

<div class="filter-bar">
  <div class="position-icons position-selector">
    <span title="ì „ì²´" onclick="selectPosition(this)">â­</span>
    <span title="íƒ‘" onclick="selectPosition(this)">ğŸ›¡ï¸</span>
    <span title="ì •ê¸€" onclick="selectPosition(this)">ğŸŒ¿</span>
    <span title="ë¯¸ë“œ" onclick="selectPosition(this)">ğŸª„</span>
    <span title="ì›ë”œ" onclick="selectPosition(this)">ğŸ”«</span>
    <span title="ì„œí¬í„°" onclick="selectPosition(this)">ğŸª½</span>
  </div>
  <select>
    <option>í‹°ì–´ ì „ì²´</option>
    <option>ì•„ì´ì–¸</option>
    <option>ë¸Œë¡ ì¦ˆ</option>
    <option>ì‹¤ë²„</option>
    <option>ê³¨ë“œ</option>
    <option>í”Œë˜í‹°ë„˜</option>
    <option>ë‹¤ì´ì•„</option>
    <option>ë§ˆìŠ¤í„°</option>
    <option>ê·¸ëœë“œë§ˆìŠ¤í„°</option>
    <option>ì±Œë¦°ì €</option>
  </select>
  <button class="recruit-button" onclick="toggleRecruitPopup()">ëª¨ì§‘í•˜ê¸°</button>
</div>

<div class="recruit-list">
  <div class="recruit-header">
    <span>íŒŒí‹°ì´ë¦„</span>
    <span>íƒ€ì…</span>
    <span>ìƒì„±ì¼ì</span>
    <span>ì¢…ë£Œì¼ì</span>
    <span>ìƒíƒœ</span>
    <span>í˜„ì¬ ì¸ì›</span>
    <span>ìµœëŒ€ ì¸ì›</span>
    <span>íŒŒí‹° ë²ˆí˜¸</span>
    <span></span>
  </div>
  <div class="recruit-item" th:each="party : ${parties}">
    <span>
      <a href="javascript:void(0)" class="party-detail-link"
         th:attr="data-seq=${party.partySeq},
                  data-name=${party.partyName},
                  data-type=${party.partyType},
                  data-created=${#temporals.format(party.partyCreateDate, 'yyyy-MM-dd HH:mm')},
                  data-end=${#temporals.format(party.partyEndTime, 'yyyy-MM-dd HH:mm')},
                  data-status=${party.partyStatus},
                  data-headcount=${party.partyHeadcount},
                  data-max=${party.partyMax},
                  data-memo=${party.memo},
                  data-main=${party.mainPosition},
                  data-positions=${party.positions}">
        <span th:text="${party.partyName}"></span>
      </a>
    </span>
    <span th:text="${party.partyType}"></span>
    <span th:text="${#temporals.format(party.partyCreateDate, 'yy.MM.dd HH:mm')}"></span>
    <span th:text="${#temporals.format(party.partyEndTime, 'yy.MM.dd HH:mm')}"></span>
    <span th:text="${party.partyStatus}"></span>
    <span th:text="${party.partyHeadcount}"></span>
    <span th:text="${party.partyMax}"></span>
    <span th:text="${party.partySeq}"></span>
    <span class="chat-icon" onclick="toggleChatBox('partyId-' + ${party.partySeq})">ğŸ’¬</span>
  </div>
  <div th:if="${#lists.isEmpty(parties)}" class="recruit-item" style="justify-content: center;">
    <span>í˜„ì¬ ëª¨ì§‘ ì¤‘ì¸ íŒŒí‹°ê°€ ì—†ìŠµë‹ˆë‹¤.</span>
  </div>
</div>

<div id="recruitPopup" class="recruit-popup"></div>
<div id="partyDetailPopup" class="recruit-popup"></div>
<div id="chatBox" class="chatbox">ì±„íŒ…ì°½ (ì—¬ê¸°ì— ëŒ€í™” ë‚´ìš© êµ¬í˜„ ì˜ˆì •)</div>

<script>
  function toggleRecruitPopup() {
    const popup = document.getElementById('recruitPopup');
    popup.innerHTML = `
    <h3>ìƒˆ íŒŒí‹° ëª¨ì§‘í•˜ê¸°</h3>
    <form action="/party/new" method="post">
      <label>íŒŒí‹° ì´ë¦„: <input type="text" name="partyName" required></label><br>
      <label>íŒŒí‹° íƒ€ì…:
        <select name="partyType" required>
          <option value="ì†”ë¡œë­í¬">ì†”ë¡œë­í¬</option>
          <option value="ììœ ë­í¬">ììœ ë­í¬</option>
        </select>
      </label><br>
      <label>ì¢…ë£Œì¼ì: <input type="datetime-local" name="partyEndTime" required></label><br>
      <label>ìƒíƒœ: <input type="text" name="partyStatus" value="WAITING" required></label><br>
      <label>í˜„ì¬ ì¸ì›: <input type="number" name="partyHeadcount" value="1" min="1" required></label><br>
      <label>ìµœëŒ€ ì¸ì›: <input type="number" name="partyMax" value="5" min="1" required></label><br>
      <label>ë©”ëª¨:<br><textarea name="memo" rows="3" cols="40"></textarea></label><br>
      <label>ì£¼ í¬ì§€ì…˜:
        <select name="mainPosition" required>
          <option value="TOP">íƒ‘</option>
          <option value="JUNGLE">ì •ê¸€</option>
          <option value="MID">ë¯¸ë“œ</option>
          <option value="ADC">ì›ë”œ</option>
          <option value="SUPPORT">ì„œí¬í„°</option>
          <option value="ALL">ì „ì²´</option>
        </select>
      </label><br>
      <label>ëª¨ì§‘ í¬ì§€ì…˜:<br/>
        <div>
          <label><input type="checkbox" name="positions" value="TOP"> íƒ‘</label>
          <label><input type="checkbox" name="positions" value="JUNGLE"> ì •ê¸€</label>
          <label><input type="checkbox" name="positions" value="MID"> ë¯¸ë“œ</label>
          <label><input type="checkbox" name="positions" value="ADC"> ì›ë”œ</label>
          <label><input type="checkbox" name="positions" value="SUPPORT"> ì„œí¬í„°</label>
          <label><input type="checkbox" name="positions" value="ALL"> ì „ì²´</label>
        </div>
      </label><br>
      <button type="submit">ëª¨ì§‘ ì‹œì‘</button>
      <button type="button" onclick="document.getElementById('recruitPopup').style.display='none'">ë‹«ê¸°</button>
    </form>`;
    popup.style.display = 'block';

    const checkboxes = popup.querySelectorAll("input[name='positions']");
    checkboxes.forEach(cb => {
      cb.addEventListener("change", () => {
        const selected = Array.from(checkboxes).filter(c => c.checked && c.value !== 'ALL');
        const all = popup.querySelector("input[name='positions'][value='ALL']");
        if (selected.length === 5) {
          checkboxes.forEach(c => c.checked = false);
          if (all) all.checked = true;
        } else if (all && all.checked && selected.length > 0) {
          all.checked = false;
        }
      });
    });
  }

  function showPartyDetail(seq, name, type, createDate, endDate, status, headcount, max, memo, mainPosition, positions) {
    const popup = document.getElementById('partyDetailPopup');
    popup.innerHTML = `
    <h3>íŒŒí‹° ìƒì„¸ ì •ë³´</h3>
    <p><strong>ì´ë¦„:</strong> ${name}</p>
    <p><strong>íƒ€ì…:</strong> ${type}</p>
    <p><strong>ìƒì„±ì¼ì:</strong> ${createDate}</p>
    <p><strong>ì¢…ë£Œì¼ì:</strong> ${endDate}</p>
    <p><strong>ìƒíƒœ:</strong> ${status}</p>
    <p><strong>í˜„ì¬ ì¸ì›:</strong> ${headcount}</p>
    <p><strong>ìµœëŒ€ ì¸ì›:</strong> ${max}</p>
    <p><strong>ë©”ëª¨:</strong> ${memo}</p>
    <p><strong>ì£¼ í¬ì§€ì…˜:</strong> ${mainPosition}</p>
    <p><strong>ëª¨ì§‘ í¬ì§€ì…˜:</strong> ${positions}</p>
    <div style="margin-top: 20px;">
      <a href="/party/edit/${seq}"><button>ìˆ˜ì •</button></a>
      <form action="/party/delete/${seq}" method="post" style="display:inline;">
        <button type="submit" onclick="return confirm('ì •ë§ ì‚­ì œí• ê¹Œìš”?')">ì‚­ì œ</button>
      </form>
      <button onclick="closePartyDetail()">ë‹«ê¸°</button>
    </div>`;
    popup.style.display = 'block';
  }

  function closePartyDetail() {
    const popup = document.getElementById('partyDetailPopup');
    popup.style.display = 'none';
    popup.innerHTML = '';
  }

  function toggleChatList() {
    const list = document.getElementById('chatList');
    list.style.display = list.style.display === 'block' ? 'none' : 'block';
  }
  function toggleChatBox(userId) {
    const box = document.getElementById('chatBox');
    box.style.display = box.style.display === 'block' ? 'none' : 'block';
  }
  function selectPosition(element) {
    document.querySelectorAll('.position-selector span').forEach(span => span.classList.remove('selected'));
    element.classList.add('selected');
  }
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.party-detail-link').forEach(el => {
      el.addEventListener('click', () => {
        showPartyDetail(
                el.dataset.seq,
                el.dataset.name,
                el.dataset.type,
                el.dataset.created,
                el.dataset.end,
                el.dataset.status,
                el.dataset.headcount,
                el.dataset.max,
                el.dataset.memo,
                el.dataset.main,
                el.dataset.positions
        );
      });
    });
    const params = new URLSearchParams(window.location.search);
    const rank = params.get('rank') || 'solo';
    document.getElementById(rank + 'Tab').classList.add('active');
  });
</script>
</body>
</html>
